<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="google-site-verification" content="g2JkdYuJjFbccXlyU66fF0B88ZynqrfrBVRM2M4pDJI" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>채팅 사이트 lala</title>
    <style>
        #chat {
            width: 100%;
            height: 400px;
            overflow-y: scroll;
            border: 1px solid #ccc;
            padding: 10px;
        }
        #messageInput {
            width: 100%;
            height: 50px;
        }
        .hidden {
            display: none;
        }
        #userList {
            border: 1px solid #ccc;
            padding: 10px;
            height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div id="roomList"></div>
    <input id="usernameInput" placeholder="유저 이름">
    <input id="roomInput" placeholder="방 이름">
    <button onclick="joinRoom()">방 입장</button>

    <div id="chatContainer" class="hidden">
        <div id="userList"></div>
        <div id="chat"></div>
        <textarea id="messageInput" placeholder="메시지를 입력하세요..."></textarea>
        <button onclick="sendMessage()">보내기</button>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const chat = document.getElementById('chat');
        const messageInput = document.getElementById('messageInput');
        const chatContainer = document.getElementById('chatContainer');
        const roomList = document.getElementById('roomList');
        const userList = document.getElementById('userList');

        function joinRoom() {
            const username = document.getElementById('usernameInput').value;
            const room = document.getElementById('roomInput').value;

            if (username && room) {
                chatContainer.classList.remove('hidden');
                socket.emit('joinRoom', { username, room });

                socket.on('roomUsers', (users) => {
                    const userListHtml = users.map(user => `<li>${user}</li>`).join('');
                    userList.innerHTML = `<ul>${userListHtml}</ul>`;
                });

                socket.on('rooms', (rooms) => {
                    const roomListHtml = rooms.map(room => `<li>${room}</li>`).join('');
                    roomList.innerHTML = `<ul>${roomListHtml}</ul>`;
                });

                socket.on('message', ({ username, message }) => {
                    const newMessage = document.createElement('div');
                    newMessage.textContent = `${username}: ${message}`;
                    chat.appendChild(newMessage);
                    chat.scrollTop = chat.scrollHeight;
                });
            }
        }

        function sendMessage() {
            const message = messageInput.value.trim();
            if (message) {
                socket.emit('chatMessage', message);
                messageInput.value = '';
                chat.scrollTop = chat.scrollHeight;
                messageInput.focus();
            }
        }

        messageInput.addEventListener('keydown', function(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        });
    </script>
</body>
</html>
